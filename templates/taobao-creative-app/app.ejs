let onShowCB;
let onHideCB;
App({
  onLaunch: function onLaunch(options) {
    console.info('App onLaunched');

    $global.__cocosCallback = function () {
      require('./<%= polyfillsBundleFile %>');
      require('./<%= systemJsBundleFile %>');
      require('./load-module.js');
      const importMap = require('./<%= importMapFile %>');
      let System = $global.System;
      System.warmup({
        importMap,
        importMapUrl: 'src/import-map.js',
      });
      System.import('./web-adapter.js')
      .then(() => {
        return System.import('cc');
      })
      .then((cc) => {
        return System.import('./engine-adapter.js')
        .then(() => {
          return System.import('<%= applicationJs %>')
          .then(({ Application }) => {
            const application = new Application();
            application.init(cc);
            return application.start();
          });
        });
      })
      .catch((err) => {
        console.error(err);
      });    
    };

    my.onShow = function (cb) {
      onShowCB = cb;
    };

    my.onHide = function (cb) {
      onHideCB = cb;
    };
  },
  onShow: function onShow(options) {
    onShowCB && onShowCB();
  },
  onHide: function onHide(options) {
    onHideCB && onHideCB();
  }
});